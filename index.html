                    </div>
                </div>
            </div>
          </section>

          <!-- Modal for Booking Confirmation -->
          <div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Select Your Seats</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div id="bookingDetails"></div>
                  
                  <div class="seat-selection-area mt-4">
                      <h6 class="text-center mb-3">Choose Your Seats</h6>
                      <div class="seat-legend mb-3">
                          <span class="me-3"><span class="seat-box available"></span> Available</span>
                          <span class="me-3"><span class="seat-box selected"></span> Selected</span>
                          <span><span class="seat-box booked"></span> Booked</span>
                      </div>
                      <div class="bus-layout">
                          <div class="driver-section mb-3">
                              <i class="bi bi-person-circle"></i> Driver
                          </div>
                          <div id="seatMap" class="seat-map"></div>
                      </div>
                      <div class="selected-seats-info mt-3">
                          <p><strong>Selected Seats:</strong> <span id="selectedSeatsList">None</span></p>
                      </div>
                  </div>
                  
                  <p class="mt-3 text-muted">After selecting your seats, complete your booking on WhatsApp for payment and confirmation.</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-success" id="whatsappBookingBtn" disabled>
                    <i class="bi bi-whatsapp"></i> Complete Booking on WhatsApp
                  </button>
                </div>
              </div>
            </div>
          </div>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
          <script>
              const today = new Date().toISOString().split('T')[0];
              document.getElementById('travelDate').setAttribute('min', today);

              let bookingData = {};
              let selectedSeats = [];
              let requiredSeats = 0;

              const bookedSeats = ['A2', 'B3', 'C1', 'D4', 'E2'];

              function generateSeatMap() {
                  const seatMap = document.getElementById('seatMap');
                  seatMap.innerHTML = '';
                  selectedSeats = [];
                  
                  const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                  
                  rows.forEach(row => {
                      const rowDiv = document.createElement('div');
                      rowDiv.className = 'seat-row';
                      
                      for (let i = 1; i <= 4; i++) {
                          const seatNumber = row + i;
                          const seatBtn = document.createElement('button');
                          seatBtn.type = 'button';
                          seatBtn.className = 'seat-btn';
                          seatBtn.textContent = seatNumber;
                          seatBtn.dataset.seat = seatNumber;
                          
                          if (bookedSeats.includes(seatNumber)) {
                              seatBtn.classList.add('booked');
                              seatBtn.disabled = true;
                          } else {
                              seatBtn.classList.add('available');
                              seatBtn.addEventListener('click', toggleSeat);
                          }
                          
                          rowDiv.appendChild(seatBtn);
                          
                          if (i === 2) {
                              const aisle = document.createElement('div');
                              aisle.className = 'aisle';
                              rowDiv.appendChild(aisle);
                          }
                      }
                      
                      seatMap.appendChild(rowDiv);
                  });
                  
                  updateSelectedSeatsDisplay();
              }

              function toggleSeat(e) {
                  const seatBtn = e.target;
                  const seatNumber = seatBtn.dataset.seat;
                  
                  if (seatBtn.classList.contains('selected')) {
                      seatBtn.classList.remove('selected');
                      seatBtn.classList.add('available');
                      selectedSeats = selectedSeats.filter(s => s !== seatNumber);
                  } else {
                      if (selectedSeats.length < requiredSeats) {
                          seatBtn.classList.remove('available');
                          seatBtn.classList.add('selected');
                          selectedSeats.push(seatNumber);
                      } else {
                          alert(`You can only select ${requiredSeats} seat(s) for ${requiredSeats} passenger(s).`);
                      }
                  }
                  
                  updateSelectedSeatsDisplay();
              }

              function updateSelectedSeatsDisplay() {
                  const seatsList = document.getElementById('selectedSeatsList');
                  const whatsappBtn = document.getElementById('whatsappBookingBtn');
                  
                  if (selectedSeats.length > 0) {
                      seatsList.textContent = selectedSeats.join(', ');
                  } else {
                      seatsList.textContent = 'None';
                  }
                  
                  if (selectedSeats.length === requiredSeats) {
                      whatsappBtn.disabled = false;
                  } else {
                      whatsappBtn.disabled = true;
                  }
              }

              document.getElementById('busBookingForm').addEventListener('submit', function(e) {
                  e.preventDefault();
                  
                  const fromCity = document.getElementById('fromCity').value;
                  const toCity = document.getElementById('toCity').value;
                  const travelDate = document.getElementById('travelDate').value;
                  const passengers = document.getElementById('passengers').value;

                  if (fromCity === toCity) {
                      alert('Departure and destination cities cannot be the same!');
                      return;
                  }

                  requiredSeats = parseInt(passengers);
                  bookingData = {
                      from: fromCity,
                      to: toCity,
                      date: travelDate,
                      passengers: passengers
                  };

                  const formattedDate = new Date(travelDate).toLocaleDateString('en-US', { 
                      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                  });

                  document.getElementById('bookingDetails').innerHTML = `
                      <div class="booking-summary">
                          <h6>Booking Summary:</h6>
                          <p><strong>Route:</strong> ${fromCity} â†’ ${toCity}</p>
                          <p><strong>Date:</strong> ${formattedDate}</p>
                          <p><strong>Passengers:</strong> ${passengers}</p>
                      </div>
                  `;

                  generateSeatMap();
                  const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
                  modal.show();
              });

              document.getElementById('whatsappBookingBtn').addEventListener('click', function() {
                  if (selectedSeats.length !== requiredSeats) {
                      alert(`Please select exactly ${requiredSeats} seat(s) before completing your booking.`);
                      return;
                  }
                  
                  const seatsText = selectedSeats.join(', ');
                  const message = `Hello! I want to book a bus ticket:%0A%0AFrom: ${bookingData.from}%0ATo: ${bookingData.to}%0ADate: ${bookingData.date}%0APassengers: ${bookingData.passengers}%0ASeats: ${seatsText}%0A%0APlease confirm availability and total cost.`;
                  
                  window.open(`https://wa.me/254752212826?text=${message}`, '_blank');
              });

              function selectRoute(from, to) {
                  document.getElementById('fromCity').value = from;
                  document.getElementById('toCity').value = to;
                  
                  document.getElementById('booking-form').scrollIntoView({ 
                      behavior: 'smooth' 
                  });
              }
          </script>
        </body>
</html>
